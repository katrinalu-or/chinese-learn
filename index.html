<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mommy Academy: 中文大爆炸</title>
    <link rel="stylesheet" href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <h1>Mommy Academy: 中文大爆炸</h1>
            <div class="auth-tabs">
                <button id="login-tab" class="tab-button active">Login</button>
                <button id="register-tab" class="tab-button">Register</button>
            </div>
            <div id="login-form" class="auth-form">
                <h2>Login</h2>
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button id="login-btn">Login</button>
            </div>
            <div id="register-form" class="auth-form hidden">
                <h2>Create Account</h2>
                <input type="text" id="register-username" placeholder="Username" required>
                <input type="password" id="register-password" placeholder="Password" required>
                <input type="password" id="register-confirm" placeholder="Confirm Password" required>
                <button id="register-btn">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard-screen" class="screen hidden">
        <div class="header">
            <h1>Mommy Academy: 中文大爆炸</h1>
            <div class="user-info">
                <span id="username-display"></span> 🌟 <span id="level-display">1</span>
                <button id="collections-btn">Collections</button>
                <button id="developer-mode-btn">Developer Mode</button>
                <button id="logout-btn">Logout</button>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="activity-card active" id="word-review-card">
                <h3>單字閱讀</h3>
                <p>Practice recognizing Chinese characters</p>
            </div>
            <div class="activity-card active" id="word-writing-card">
                <h3>單字書寫</h3>
                <p>Listen and practice writing words</p>
            </div>
            <div class="activity-card active" id="sentence-writing-card">
                <h3>造句練習</h3>
                <p>Practice forming sentences with key words</p>
            </div>
            <div class="activity-card active" id="mini-game-card">
                <h3>小遊戲天地</h3>
                <p>Interactive games with words</p>
            </div>
            <div class="activity-card disabled">
                <h3>Coming Soon</h3>
                <p>Activity 5</p>
            </div>
            <div class="activity-card progress-card" id="progress-card">
                <h3>升級進度</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="progress-text">0%</p>
            </div>
        </div>
    </div>

    <!-- Word Review Activity -->
    <div id="word-review-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-to-dashboard">← Back</button>
            <h2>Word Review</h2>
            <div class="header-right score-display">
                Score: <span id="current-score">0</span>/20
            </div>
        </div>
        <div class="word-display">
            <div class="word-card">
                <div class="chinese-word" id="chinese-word">準備中...</div>
                <button id="review-audio-btn" class="replay-audio-btn">🔊</button>
            </div>
            <div class="action-buttons">
                <button id="cross-btn" class="action-btn cross">✗</button>
                <button id="check-btn" class="action-btn check">✓</button>
            </div>
            <div class="progress-info" id="word-counter">
                0/20
            </div>
        </div>
    </div>

    <!-- Word Writing Activity Screen -->
    <div id="word-writing-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-writing">← Back</button>
            <h2>Word Writing</h2>
            <div class="header-right score-display">
                Score: <span id="writing-current-score">0</span>/<span id="writing-total-score">0</span>
            </div>
        </div>
        <div class="word-display">
            <div class="word-card">
                <div class="chinese-word" id="writing-chinese-word">???</div>
                <button id="replay-audio-btn" class="replay-audio-btn">🔊</button>
            </div>
            <div class="writing-controls">
                <button id="show-answer-btn" class="show-answer-btn">Show Answer</button>
            </div>
            <div class="action-buttons">
                <button id="writing-cross-btn" class="action-btn cross">✗</button>
                <button id="writing-check-btn" class="action-btn check">✓</button>
            </div>
            <div class="progress-info" id="writing-word-counter">
                0/10
            </div>
        </div>
    </div>

    <!-- Sentence Writing Activity Screen -->
    <div id="sentence-writing-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-sentence">← Back</button>
            <h2>Sentence Writing</h2>
            <div class="header-right"></div>
        </div>
        <div class="sentence-writing-container">
            <div class="sentence-instructions">
                <h3>Practice Words</h3>
                <p>Use the following 10 words to practice forming sentences. When you're done, mark this activity as complete.</p>
            </div>
            <div class="sentence-word-grid" id="sentence-word-grid"></div>
            <div class="action-buttons">
                <button id="sentence-cross-btn" class="action-btn cross">✗</button>
                <button id="sentence-check-btn" class="action-btn check">✓</button>
            </div>
            <p class="completion-status-text">Click ✓ to mark this task as complete for this level.</p>
        </div>
    </div>

    <!-- Mini Game Center Screen -->
    <div id="mini-game-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-mini-games">← Back</button>
            <h2>Mini Game Center</h2>
            <div class="header-right">
                 <!-- Exchange ticket display removed from here -->
            </div>
        </div>
        <div class="mini-games-container">
            <div class="mini-games-grid" id="mini-games-grid">
                <!-- Games will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Individual Game Screen -->
    <div id="game-play-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-game">← Back</button>
            <h2 id="game-title">Game</h2>
            <div class="header-right">
                <!-- Game score display removed from here -->
            </div>
        </div>
        <div class="game-container">
            <div id="game-content">
                <!-- Dynamic game content will be inserted here -->
            </div>
            <div class="game-controls">
                <button id="check-game-btn" class="game-action-btn">Check Answer</button>
                <button id="reset-game-btn" class="game-action-btn secondary">Reset</button>
            </div>
        </div>
    </div>

    <!-- Progress Detail Screen -->
    <div id="progress-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-progress">← Back</button>
            <h2>Level Progress</h2>
            <div class="header-right"></div>
        </div>
        <div class="progress-details">
            <!-- Reordered sections -->
            <div class="word-progress" id="word-review-progress"></div>
            <div class="word-progress" id="word-writing-progress"></div>
            <div class="word-progress" id="sentence-writing-progress"></div>
            <div class="word-progress" id="activity-log-container">
                <h4>Activity Log</h4>
                <div id="activity-calendar"></div>
            </div>
        </div>
    </div>

    <!-- Developer Mode -->
    <div id="developer-screen" class="screen hidden">
        <div class="header">
            <button id="back-from-dev">← Back</button>
            <h2>Developer Mode</h2>
            <div class="dev-actions">
                <span class="version-info" id="app-version-display"></span>
            </div>
        </div>
        <div class="developer-content">
            <div class="backup-section">
                <h3>Data Management</h3>
                <p>💡 Use backup to save your progress to a file. Use restore to load progress from a backup file.</p>
                <div class="data-actions">
                    <button id="backup-btn" class="dev-btn">💾 Backup Data</button>
                    <button id="restore-btn" class="dev-btn">📂 Restore Data</button>
                </div>
            </div>
            <div class="wordlist-section">
                <h3>Word List Management</h3>
                <p>Download the current word list as a JSON file, edit it, and upload it to apply changes. You can also reset all levels to the default word lists.</p>
                <div class="wordlist-actions">
                    <button id="download-wordlist-btn" class="dev-btn">📥 Download Word List</button>
                    <button id="upload-wordlist-btn" class="dev-btn">📤 Upload Word List</button>
                    <button id="reset-wordlist-btn" class="reset-btn">🔄 Reset to Default</button>
                </div>
            </div>
            <div class="reset-section">
                <h3>Reset Level</h3>
                <div class="reset-controls">
                    <div class="reset-info">
                        <p>Current Level: <strong id="current-level-display">1</strong></p>
                        <p>⚠️ This will reset your level and clear all word progress. This action cannot be undone!</p>
                    </div>
                    <div class="reset-input">
                        <label for="reset-level-select">Reset to Level:</label>
                        <select id="reset-level-select">
                            <!-- Options are now generated dynamically by script.js -->
                        </select>
                        <button id="reset-level-btn" class="reset-btn">Reset Level</button>
                    </div>
                </div>
            </div>
            <div class="minigame-reset-section">
                <h3>Mini-Game Reset</h3>
                <div class="minigame-reset-info">
                    <p>💡 Use this to completely reset all mini-game data and force reload from minigame.json file.</p>
                    <p>⚠️ This will clear all mini-game progress, cached content, and regenerate games. This action cannot be undone!</p>
                </div>
                <div class="minigame-reset-actions">
                    <button id="reset-minigames-btn" class="reset-btn">Reset Mini Games</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collections Screen -->
    <div id="collections-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-collections">← Back</button>
            <h2>Collections</h2>
            <div class="header-right">
                <div class="currency-display">
                    <div class="diamond-display">
                        <span class="diamond-icon">💎</span>
                        <span id="diamond-count">0</span>
                    </div>
                    <div id="exchange-ticket-wrapper" class="exchange-ticket-display">
                        <span class="ticket-icon">🎟️</span>
                        <span id="exchange-ticket-count-collections">0</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="gacha-container">
            <!-- Gacha Controls -->
            <div class="gacha-controls">
                <button id="draw-gacha-btn" class="gacha-draw-btn">Draw (1💎)</button>
                <div class="gacha-draw-wrapper">
                    <button id="draw-ten-gacha-btn" class="gacha-draw-btn multi-draw">Draw 10 (10💎)</button>
                    <div class="tooltip-icon">?
                        <span class="tooltip-text" id="gacha-tooltip-text"></span>
                    </div>
                </div>
            </div>
            <!-- Exchange UI -->
            <div id="exchange-ui" class="exchange-ui-container hidden">
                <div class="exchange-status">
                    <h2>Exchange Mode</h2>
                    <p>Select items below to trade for points. Then, use the points to get a new item from a chosen rarity.<br>You can trade multiple times. Click on the Exchange Ticket icon on the top right again to exit.</p>
                    <div class="exchange-points-display">
                        Your Points: <strong id="exchange-total-points">0</strong>
                    </div>
                </div>
                <div id="exchange-buy-options" class="exchange-buy-options">
                    <!-- JS will populate buttons here -->
                </div>
            </div>
            <div class="collection-grid-container">
                <h3>Greek Gods Collection</h3>
                <p class="collection-subtitle">Event: Sep 14 ~ Oct 15 2025</p>
                <div class="collection-grid" id="collection-grid"></div>
            </div>
        </div>
    </div>

    <!-- Gacha Modals -->
    <div id="gacha-result-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="gacha-result-content"> <!-- This is the new wrapper -->
                <h2 id="gacha-result-rarity"></h2>
                <img id="gacha-result-image" src="" alt="Gacha Result">
                <h3 id="gacha-result-name"></h3>
            </div>
            <button id="close-gacha-modal-btn">Awesome!</button>
        </div>
    </div>
    <div id="gacha-multi-result-modal" class="modal-overlay hidden">
        <div class="modal-content multi-result-modal">
            <h2>Your 10 Draws!</h2>
            <div id="multi-result-grid" class="multi-result-grid"></div>
            <button id="close-multi-gacha-modal-btn">Awesome!</button>
        </div>
    </div>

    <!-- Calendar Tooltip -->
    <div id="calendar-tooltip" class="hidden"></div>

    <!-- File Inputs -->
    <input type="file" id="import-file" accept=".json" style="display: none;">
    <input type="file" id="import-wordlist-file" accept=".json" style="display: none;">
    <script src="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="script.js"></script>
</body>
</html>