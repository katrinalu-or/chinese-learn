<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mommy Academy: ‰∏≠ÊñáÂ§ßÁàÜÁÇ∏</title>
    <link rel="stylesheet" href="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Login/Register Screen -->
    <div id="auth-screen" class="screen">
        <div class="auth-container">
            <h1>Mommy Academy: ‰∏≠ÊñáÂ§ßÁàÜÁÇ∏</h1>
            <div class="auth-tabs">
                <button id="login-tab" class="tab-button active">Login</button>
                <button id="register-tab" class="tab-button">Register</button>
            </div>
            <div id="login-form" class="auth-form">
                <h2>Login</h2>
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button id="login-btn">Login</button>
            </div>
            <div id="register-form" class="auth-form hidden">
                <h2>Create Account</h2>
                <input type="text" id="register-username" placeholder="Username" required>
                <input type="password" id="register-password" placeholder="Password" required>
                <input type="password" id="register-confirm" placeholder="Confirm Password" required>
                <button id="register-btn">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard-screen" class="screen hidden">
        <div class="header">
            <h1>Mommy Academy: ‰∏≠ÊñáÂ§ßÁàÜÁÇ∏</h1>
            <div class="user-info">
                <span id="username-display"></span> üåü <span id="level-display">1</span>
                <button id="collections-btn">Collections</button>
                <button id="developer-mode-btn">Developer Mode</button>
                <button id="logout-btn">Logout</button>
            </div>
        </div>
        <div class="dashboard-grid">
            <div class="activity-card active" id="word-review-card">
                <h3>ÂñÆÂ≠óÈñ±ËÆÄ</h3>
                <p>Practice recognizing Chinese characters</p>
            </div>
            <div class="activity-card active" id="word-writing-card">
                <h3>ÂñÆÂ≠óÊõ∏ÂØ´</h3>
                <p>Listen and practice writing words</p>
            </div>
            <div class="activity-card active" id="sentence-writing-card">
                <h3>ÈÄ†Âè•Á∑¥Áøí</h3>
                <p>Practice forming sentences with key words</p>
            </div>
            <div class="activity-card active" id="mini-game-card">
                <h3>Â∞èÈÅäÊà≤Â§©Âú∞</h3>
                <p>Interactive games with words</p>
            </div>
            <div class="activity-card active" id="social-studies-card">
                <h3>ÊñáÂåñ‰∏≠ÂøÉ</h3>
                <p>Immersive cultural activites<br>Earn cultural points and unlock perks!</p>
            </div>
            <div class="activity-card progress-card" id="progress-card">
                <h3>ÂçáÁ¥öÈÄ≤Â∫¶</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="progress-text">0%</p>
            </div>
        </div>
    </div>

    <!-- Word Review Activity -->
    <div id="word-review-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-to-dashboard">‚Üê Back</button>
            <h2>Word Review</h2>
            <div class="header-right score-display">
                Score: <span id="current-score">0</span>/20
            </div>
        </div>
        <div class="word-display">
            <div class="progress-info" id="word-counter">
                0/20
            </div>
            <div class="word-card">
                <div class="chinese-word" id="chinese-word">Ê∫ñÂÇô‰∏≠...</div>
                <button id="review-audio-btn" class="replay-audio-btn">üîä</button>
            </div>
            <div class="action-buttons">
                <button id="cross-btn" class="action-btn cross">‚úó</button>
                <button id="check-btn" class="action-btn check">‚úì</button>
            </div>
        </div>
    </div>

    <!-- Word Writing Activity Screen -->
    <div id="word-writing-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-writing">‚Üê Back</button>
            <h2>Word Writing</h2>
            <div class="header-right score-display">
                Score: <span id="writing-current-score">0</span>/<span id="writing-total-score">0</span>
            </div>
        </div>
        <div class="word-display">
            <div class="progress-info" id="writing-word-counter">
                0/10
            </div>
            <div class="word-card">
                <div class="chinese-word" id="writing-chinese-word">???</div>
                <button id="replay-audio-btn" class="replay-audio-btn">üîä</button>
            </div>
            <div class="writing-controls">
                <button id="show-answer-btn" class="show-answer-btn">Show Answer</button>
            </div>
            <div class="action-buttons">
                <button id="writing-cross-btn" class="action-btn cross">‚úó</button>
                <button id="writing-check-btn" class="action-btn check">‚úì</button>
            </div>
        </div>
    </div>

    <!-- Sentence Writing Activity Screen -->
    <div id="sentence-writing-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-sentence">‚Üê Back</button>
            <h2>Sentence Writing</h2>
            <div class="header-right"></div>
        </div>
        <div class="sentence-writing-container">
            <div class="sentence-instructions">
                <p>Use the following words to practice forming sentences. When you're done, mark this activity as complete.</p>
            </div>
            <div class="sentence-word-grid" id="sentence-word-grid"></div>
            <div class="action-buttons">
                <button id="sentence-cross-btn" class="action-btn cross">‚úó</button>
                <button id="sentence-check-btn" class="action-btn check">‚úì</button>
            </div>
        </div>
    </div>

    <!-- Mini Game Center Screen -->
    <div id="mini-game-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-mini-games">‚Üê Back</button>
            <h2>Mini Game Center</h2>
            <div class="header-right">
                 <!-- Exchange ticket display removed from here -->
            </div>
        </div>
        <div class="mini-games-container">
            <div class="mini-games-grid" id="mini-games-grid">
                <!-- Games will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Social Studies Screen -->
    <div id="social-studies-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-social-studies">‚Üê Back</button>
            <h2>ÊñáÂåñ‰∏≠ÂøÉ</h2>
            <div class="header-right">
                <span class="perk-icon" title="Cultural Points">üéµ</span>
                <span id="cultural-points-display">0</span>
                <button id="cultural-recognition-btn" class="header-icon-btn" title="Cultural Recognition">üèõÔ∏è</button>
            </div>
        </div>
        <div class="social-studies-container">
            <div class="social-studies-tabs-container">
                <button class="social-studies-tab-button active" data-tab="history">Ê≠∑Âè≤ History</button>
                <button class="social-studies-tab-button" data-tab="geography">Âú∞ÁêÜ Geography</button>
                <button class="social-studies-tab-button" data-tab="idioms">ÊàêË™û</button>
                <button class="social-studies-tab-button" data-tab="literature">ÊñáÂ≠∏ Literature</button>
                <button class="social-studies-tab-button" data-tab="culture">‰∫∫Êñá Culture</button>
            </div>
            <div class="social-studies-content-container">
                <!-- This wrapper will now contain the quiz content and be toggled -->
                <div class="quiz-content-wrapper">
                    <!-- History Tab Content -->
                    <div id="history-content" class="social-studies-tab-content">
                        <div class="quiz-header">
                            <div class="tab-controls">
                                <label for="history-level-select">Level:</label>
                                <select id="history-level-select" class="level-select-dropdown"></select>
                            </div>
                            <h3 class="quiz-title"></h3>
                            <div class="quiz-page-status"></div>
                        </div>
                        <div class="tab-display-content">
                            <p>Content for History at the selected level will appear here.</p>
                        </div>
                    </div>
                    <!-- Geography Tab Content -->
                    <div id="geography-content" class="social-studies-tab-content hidden">
                        <div class="quiz-header">
                            <div class="tab-controls">
                                <label for="geography-level-select">Level:</label>
                                <select id="geography-level-select" class="level-select-dropdown"></select>
                            </div>
                            <h3 class="quiz-title"></h3>
                            <div class="quiz-page-status"></div>
                        </div>
                        <div class="tab-display-content">
                            <p>Content for Geography at the selected level will appear here.</p>
                        </div>
                    </div>
                    <!-- Idioms Tab Content -->
                    <div id="idioms-content" class="social-studies-tab-content hidden">
                        <div class="quiz-header">
                            <div class="tab-controls">
                                <label for="idioms-level-select">Level:</label>
                                <select id="idioms-level-select" class="level-select-dropdown"></select>
                            </div>
                            <h3 class="quiz-title"></h3>
                            <div class="quiz-page-status"></div>
                        </div>
                        <div class="tab-display-content">
                            <p>Content for Idioms at the selected level will appear here.</p>
                        </div>
                    </div>
                    <!-- Literature Tab Content -->
                    <div id="literature-content" class="social-studies-tab-content hidden">
                        <div class="quiz-header">
                            <div class="tab-controls">
                                <label for="literature-level-select">Level:</label>
                                <select id="literature-level-select" class="level-select-dropdown"></select>
                            </div>
                            <h3 class="quiz-title"></h3>
                            <div class="quiz-page-status"></div>
                        </div>
                        <div class="tab-display-content">
                            <p>Content for Literature at the selected level will appear here.</p>
                        </div>
                    </div>
                    <!-- Culture Tab Content -->
                    <div id="culture-content" class="social-studies-tab-content hidden">
                        <div class="quiz-header">
                            <div class="tab-controls">
                                <label for="culture-level-select">Level:</label>
                                <select id="culture-level-select" class="level-select-dropdown"></select>
                            </div>
                            <h3 class="quiz-title"></h3>
                            <div class="quiz-page-status"></div>
                        </div>
                        <div class="tab-display-content">
                            <!-- JS will render the quiz here -->
                        </div>
                    </div>

                    <!-- Page Navigation -->
                    <div class="quiz-navigation-controls">
                        <button class="game-action-btn secondary hidden" id="prev-ss-page-btn">Previous Page</button>
                        <div id="ss-submit-placeholder"></div>
                        <button class="game-action-btn secondary hidden" id="next-ss-page-btn">Next Page</button>
                        <button id="start-social-studies-btn" class="game-action-btn hidden">Start Quiz</button>
                        <button id="review-social-studies-btn" class="game-action-btn hidden">Review Quiz</button>
                        <button id="restart-social-studies-level-btn" class="game-action-btn hidden">Restart Quiz</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cultural Recognition Screen -->
    <div id="cultural-recognition-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-recognition">‚Üê Back</button>
            <h2>Cultural Recognition</h2>
            <div class="header-right">
                <span class="perk-icon" title="Cultural Points">üéµ</span>
                <span id="cultural-points-display-recognition">0</span>
            </div>
        </div>
        <div class="recognition-grid-container">
            <div class="recognition-grid">
                <div class="recognition-box">
                    <h4>Legendary Probability Increase</h4>
                    <p>Permanently increase the chance of drawing Legendary items.</p>
                </div>
                <div class="recognition-box">
                    <h4>Draw 10 Extra Perks</h4>
                    <p>Gain bonus rewards when using the "Draw 10" feature.</p>
                </div>
                <div class="recognition-box">
                    <h4>Reduced Exchange Rate</h4>
                    <p>Get more points for your items in Exchange Mode.</p>
                </div>
                <div class="recognition-box">
                    <h4>Diamond Discount</h4>
                    <p>Use 9üíé instead of 10üíé for 'Draw 10'</p>
                </div>
                <div class="recognition-box">
                    <h4>Budget for Collection Completion Reward + $5</h4>
                    <p>Unlock it for Villains collection. Will be reset in next collection</p>
                </div>
                <div class="recognition-box">
                    <h4>Redeem Reward for Second Collection Completionh</h4>
                    <p>Unlock it for Villains collection. Will be reset in next collection.</p>
                </div>
                <div class="recognition-box placeholder">
                    <h4>???</h4>
                    <p>More perks coming soon!</p>
                </div>
                <div class="recognition-box">
                    <h4>Seasonal Limited Theme</h4>
                    <p>Unlock access to exclusive, time-limited theme</p>
                    <div class="theme-selector-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Individual Game Screen -->
    <div id="game-play-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-game">‚Üê Back</button>
            <h2 id="game-title">Game</h2>
            <div class="header-right">
                <!-- Game score display removed from here -->
            </div>
        </div>
        <div class="game-container">
            <div id="game-content">
                <!-- Dynamic game content will be inserted here -->
            </div>
            <div class="game-controls">
                <button id="check-game-btn" class="game-action-btn">Check Answer</button>
                <button id="reset-game-btn" class="game-action-btn secondary">Reset</button>
            </div>
        </div>
    </div>

    <!-- Progress Detail Screen -->
    <div id="progress-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-progress">‚Üê Back</button>
            <h2>Level Progress</h2>
            <div class="header-right"></div>
        </div>
        <div class="progress-details">
            <!-- Reordered sections -->
            <div class="word-progress" id="word-review-progress"></div>
            <div class="word-progress" id="word-writing-progress"></div>
            <div class="word-progress" id="sentence-writing-progress"></div>
            <div class="word-progress" id="activity-log-container">
                <h4>Activity Log</h4>
                <div id="activity-calendar"></div>
            </div>
        </div>
    </div>

    <!-- Developer Mode -->
    <div id="developer-screen" class="screen hidden">
        <div class="header">
            <button id="back-from-dev">‚Üê Back</button>
            <h2>Developer Mode</h2>
            <div class="dev-actions">
                <span class="version-info" id="app-version-display"></span>
            </div>
        </div>
        <div class="developer-content">
            <div class="theme-section">
                <h3>Theme Selection</h3>
                <p>üí° Themes are limited editions unlocked via the Cultural Recognition page.</p>
                <div class="theme-selector-container" id="dev-theme-selector">
                    <!-- Theme buttons will be rendered here by JS -->
                </div>
            </div>
            <div class="backup-section">
                <h3>Data Management</h3>
                <p>üí° Use backup to save your progress to a file. Use restore to load progress from a backup file.</p>
                <div class="data-actions">
                    <button id="backup-btn" class="dev-btn">üíæ Backup Data</button>
                    <button id="restore-btn" class="dev-btn">üìÇ Restore Data</button>
                </div>
            </div>
            <div class="wordlist-section">
                <h3>Word List Management</h3>
                <p>Download the current word list as a JSON file, edit it, and upload it to apply changes. You can also reset all levels to the default word lists.</p>
                <div class="wordlist-actions">
                    <button id="download-wordlist-btn" class="dev-btn">üì• Download Word List</button>
                    <button id="upload-wordlist-btn" class="dev-btn">üì§ Upload Word List</button>
                    <button id="reset-wordlist-btn" class="reset-btn">üîÑ Reset to Default</button>
                </div>
            </div>
            <div class="reset-section">
                <h3>Reset Level</h3>
                <div class="reset-controls">
                    <div class="reset-info">
                        <p>Current Level: <strong id="current-level-display">1</strong></p>
                        <p>‚ö†Ô∏è This will reset your level and clear all word progress. This action cannot be undone!</p>
                    </div>
                    <div class="reset-input">
                        <label for="reset-level-select">Reset to Level:</label>
                        <select id="reset-level-select">
                            <!-- Options are now generated dynamically by script.js -->
                        </select>
                        <button id="reset-level-btn" class="reset-btn">Reset Level</button>
                    </div>
                </div>
            </div>
            <div class="minigame-reset-section">
                <h3>Mini-Game Reset</h3>
                <div class="minigame-reset-info">
                    <p>üí° Use this to completely reset all mini-game data and force reload from minigame.json file.</p>
                    <p>‚ö†Ô∏è This will clear all mini-game progress, cached content, and regenerate games. This action cannot be undone!</p>
                </div>
                <div class="minigame-reset-actions">
                    <button id="reset-minigames-btn" class="reset-btn">Reset Mini Games</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Collections History Screen -->
    <div id="collections-history-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-collections-history">‚Üê Back</button>
            <h2>Collection Book</h2>
            <div class="header-right"></div>
        </div>
        <div class="collections-history-container">
            <div class="collection-archive-grid-container">
                <h3>Greek Gods Collection</h3>
                <p class="collection-subtitle archived">Event: Sep 14 ~ Oct 15 2025 (Ended)</p>
                <div class="collection-grid" id="greek-collection-grid"></div>
            </div>
        </div>
    </div>

    <!-- Collections Screen -->
    <div id="collections-screen" class="screen hidden">
        <div class="header page-header">
            <button id="back-from-collections">‚Üê Back</button>
            <h2>Collections</h2>
            <div class="header-right">
                <div class="currency-display">
                    <div class="diamond-display">
                        <span class="diamond-icon">üíé</span>
                        <span id="diamond-count">0</span>
                    </div>
                    <button id="exchange-ticket-wrapper" class="header-icon-btn" type="button" title="Enter Exchange Mode">
                        <span class="ticket-icon">üéüÔ∏è</span>
                        <span id="exchange-ticket-count-collections">0</span>
                    </button>
                    <button id="collections-history-btn" class="header-icon-btn" title="Collection Book">üóÉÔ∏è</button>
                </div>
            </div>
        </div>
        <div class="gacha-container">
            <!-- Gacha Controls -->
            <div class="gacha-controls">
                <button id="draw-gacha-btn" class="gacha-draw-btn">Draw (1üíé)</button>
                <div class="gacha-draw-wrapper">
                    <button id="draw-ten-gacha-btn" class="gacha-draw-btn multi-draw">Draw 10 (10üíé)</button>
                    <div class="tooltip-icon">?
                        <span class="tooltip-text" id="gacha-tooltip-text"></span>
                    </div>
                </div>
            </div>
            <!-- Exchange UI -->
            <div id="exchange-ui" class="exchange-ui-container hidden">
                <div class="exchange-status">
                    <h2>Exchange Mode</h2>
                    <p>Select items below to trade for points. Then, use the points to get a new item from a chosen rarity.<br>You can trade multiple times. But once you exits this page, you won't be able to re-enter.</p>
                    <div class="exchange-points-display">
                        Your Points: <strong id="exchange-total-points">0</strong>
                    </div>
                </div>
                <div id="exchange-buy-options" class="exchange-buy-options">
                    <!-- JS will populate buttons here -->
                </div>
            </div>
            <div class="collection-grid-container">
                <h3>Disney Villains Collection</h3>
                <p class="collection-subtitle">Event: Oct 16 ~ Nov 16 2025</p>
                <div class="collection-grid" id="collection-grid"></div>
            </div>
        </div>
    </div>

    <!-- Gacha Modals -->
    <div id="gacha-result-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div id="gacha-result-content"> <!-- This is the new wrapper -->
                <h2 id="gacha-result-rarity"></h2>
                <img id="gacha-result-image" src="" alt="Gacha Result">
                <h3 id="gacha-result-name"></h3>
            </div>
            <button id="close-gacha-modal-btn">Awesome!</button>
        </div>
    </div>
    <div id="gacha-multi-result-modal" class="modal-overlay hidden">
        <div class="modal-content multi-result-modal">
            <h2>Your 10 Draws!</h2>
            <div id="multi-result-grid" class="multi-result-grid"></div>
            <div id="multi-result-bonus" class="hidden"></div>
            <button id="close-multi-gacha-modal-btn">Awesome!</button>
        </div>
    </div>

    <!-- Calendar Tooltip -->
    <div id="calendar-tooltip" class="hidden"></div>

    <!-- File Inputs -->
    <input type="file" id="import-file" accept=".json" style="display: none;">
    <input type="file" id="import-wordlist-file" accept=".json" style="display: none;">
    <script src="https://unpkg.com/js-year-calendar@latest/dist/js-year-calendar.min.js"></script>
    <script src="script.js"></script>

    <!-- Script for dynamic header height -->
    <script>
        function updateHeaderHeight() {
            const visibleScreen = document.querySelector('.screen:not(.hidden)');
            if (!visibleScreen) return;

            const header = visibleScreen.querySelector('.header');
            const historyContainer = visibleScreen.querySelector('.collections-history-container');
            let headerHeight = 0;

            if (header) {
            headerHeight = header.offsetHeight;
            document.documentElement.style.setProperty('--header-height', `${headerHeight}px`);
            }

            // --- JAVASCRIPT FIX FOR IPAD ---
            if (historyContainer) {
                const viewportHeight = window.innerHeight;
                const containerHeight = viewportHeight - headerHeight;

                // Apply the calculated height directly to the container's style
                historyContainer.style.minHeight = `${containerHeight}px`;
                historyContainer.style.backgroundSize = `100vw ${containerHeight}px`;
            }
        }

        // Run on initial load and when a screen's visibility changes
        document.addEventListener('DOMContentLoaded', () => {
            updateHeaderHeight();

            const screens = document.querySelectorAll('.screen');
            const observer = new MutationObserver(() => {
                // A short delay ensures the layout is complete before measuring
                setTimeout(updateHeaderHeight, 50);
            });

            screens.forEach(screen => {
                observer.observe(screen, { attributes: true, attributeFilter: ['class'] });
            });
        });

        // Also run when the window is resized
        window.addEventListener('resize', updateHeaderHeight);
    </script>
</body>
</html>